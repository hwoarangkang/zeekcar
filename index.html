<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ‡¹ğŸ‡¼ å°ç£è»Šå¸‚éŠ·å”®æ’è¡Œç ”ç©¶æ‰€</title>
    
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232563EB'%3E%3Cpath d='M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.21.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z'/%3E%3C/svg%3E">

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            corePlugins: { preflight: false } // WordPress é˜²è·‘ç‰ˆè¨­å®š
        }
    </script>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        #car-sales-app { font-family: 'Noto Sans TC', sans-serif; line-height: 1.5; }
        [v-cloak] { display: none; }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        #car-sales-app button { border-style: solid; cursor: pointer; }
        #car-sales-app input, #car-sales-app select { border-style: solid; }
        #car-sales-app table { width: 100%; border-collapse: collapse; }
        .rank-badge { width: 1.5rem; height: 1.5rem; display: inline-flex; align-items: center; justify-content: center; border-radius: 9999px; font-size: 0.75rem; font-weight: bold; color: white; }
        .hover-lift:hover { transform: translateY(-2px); transition: transform 0.2s; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

<div id="car-sales-app" v-cloak class="max-w-6xl mx-auto min-h-screen flex flex-col bg-gray-50">
    
    <header class="bg-white shadow-sm sticky top-0 z-20 border-b border-gray-200">
        <div class="container mx-auto px-4 py-4 flex flex-col md:flex-row justify-between items-center gap-4">
            <div class="flex items-center gap-3">
                <div class="bg-blue-600 text-white p-2 rounded-lg flex items-center justify-center w-10 h-10">
                    <i class="fas fa-car-side text-xl"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold text-gray-900 leading-tight m-0">å°ç£è»Šå¸‚éŠ·å”®æ’è¡Œç ”ç©¶æ‰€</h1>
                    <p class="text-xs text-gray-500 m-0">è³‡æ–™ä¾†æºï¼šç›£ç†æ‰€é ˜ç‰Œæ˜ç´° (2025å¹´ 10æœˆ æ›´æ–°)</p>
                </div>
            </div>
            
            <div class="flex bg-gray-100 p-1 rounded-lg">
                <button @click="currentView = 'dashboard'" :class="{'bg-white shadow text-blue-600': currentView === 'dashboard', 'text-gray-600 hover:bg-gray-200': currentView !== 'dashboard'}" class="px-4 py-2 rounded-md text-sm font-bold transition border-0">
                    <i class="fas fa-trophy mr-1"></i> æˆ°æ³
                </button>
                <button @click="currentView = 'ranking'" :class="{'bg-white shadow text-blue-600': currentView === 'ranking', 'text-gray-600 hover:bg-gray-200': currentView !== 'ranking'}" class="px-4 py-2 rounded-md text-sm font-bold transition border-0">
                    <i class="fas fa-list-ol mr-1"></i> æ¦œå–®
                </button>
                <button @click="currentView = 'trend'" :class="{'bg-white shadow text-blue-600': currentView === 'trend', 'text-gray-600 hover:bg-gray-200': currentView !== 'trend'}" class="px-4 py-2 rounded-md text-sm font-bold transition border-0">
                    <i class="fas fa-chart-line mr-1"></i> è¶¨å‹¢
                </button>
            </div>
        </div>
    </header>

    <main class="flex-1 container mx-auto px-4 py-6">
        <div v-if="loading" class="text-center py-20 text-gray-500"><i class="fas fa-spinner fa-spin text-4xl mb-4"></i><p>è¼‰å…¥æœ€æ–°æ•¸æ“šä¸­...</p></div>
        
        <div v-else>
            <div v-if="currentView === 'dashboard'" class="space-y-8">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800 m-0 flex items-center">
                        <i class="fas fa-crown text-yellow-500 mr-2"></i> æœ¬æœˆéŠ·å”®æˆ°å ±
                    </h2>
                    <div class="relative inline-block">
                        <select v-model="selectedMonth" class="appearance-none bg-white border border-gray-300 px-4 py-2 pr-8 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 font-bold text-gray-700 cursor-pointer">
                            <option v-for="m in sortedMonths" :value="m">{{ formatMonth(m) }}</option>
                        </select>
                        <i class="fas fa-chevron-down absolute right-3 top-3 text-gray-400 pointer-events-none"></i>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div v-for="battle in battlefields" :key="battle.title" class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition flex flex-col hover-lift">
                        <div class="px-5 py-3 border-b border-gray-100 flex justify-between items-center cursor-pointer" :class="battle.bgLight" @click="jumpToRanking(battle.filterKey)">
                            <div class="flex items-center gap-2">
                                <i :class="[battle.icon, battle.textClass]"></i>
                                <h3 class="font-bold text-gray-800 m-0">{{ battle.title }}</h3>
                            </div>
                            <button class="text-xs font-bold text-gray-500 hover:text-blue-600 bg-white bg-opacity-50 px-2 py-1 rounded border border-transparent hover:border-blue-200 transition">
                                å®Œæ•´æ¦œå–® &raquo;
                            </button>
                        </div>
                        <div class="p-5 flex-1 flex flex-col justify-between cursor-pointer" @click="jumpToRanking(battle.filterKey)">
                            <div v-if="battle.data.length > 0" class="mb-4">
                                <div class="flex justify-between items-end mb-1">
                                    <span class="text-xs font-bold text-yellow-600 bg-yellow-100 px-2 py-0.5 rounded-full">CHAMPION</span>
                                    <span class="text-3xl font-black text-gray-800 leading-none">{{ battle.data[0].count.toLocaleString() }}</span>
                                </div>
                                <h4 class="text-xl font-bold text-blue-900 leading-tight m-0">{{ battle.data[0].model }}</h4>
                                <p class="text-xs text-gray-400 m-0 mt-1">{{ battle.data[0].brand }}</p>
                            </div>
                            <div v-else class="text-center py-8 text-gray-300">æœ¬æœˆç„¡è³‡æ–™</div>
                            <div v-if="battle.data.length > 1" class="border-t border-gray-100 pt-3 mt-2 space-y-2">
                                <div v-for="(car, idx) in battle.data.slice(1, 3)" :key="idx" class="flex justify-between items-center text-sm">
                                    <div class="flex items-center gap-2 overflow-hidden">
                                        <span class="rank-badge" :class="idx === 0 ? 'bg-gray-400' : 'bg-orange-700'">{{ idx + 2 }}</span>
                                        <span class="font-medium text-gray-700 truncate">{{ car.model }}</span>
                                    </div>
                                    <span class="font-bold text-gray-600">{{ car.count.toLocaleString() }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 mt-8 overflow-hidden">
                    <div class="bg-gray-50 px-6 py-4 border-b border-gray-200">
                        <h3 class="font-bold text-gray-700 m-0">ğŸ”¥ å…¨å¸‚å ´ç¸½æ’å Top 10</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full min-w-[600px]">
                            <thead class="bg-gray-50 text-xs text-gray-500 uppercase">
                                <tr>
                                    <th class="px-6 py-3 text-center w-16">Rank</th>
                                    <th class="px-6 py-3 text-left">Model</th>
                                    <th class="px-6 py-3 text-center">Type</th>
                                    <th class="px-6 py-3 text-right">Units</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                <tr v-for="(car, idx) in top10List" :key="idx" class="hover:bg-blue-50 transition">
                                    <td class="px-6 py-4 text-center">
                                        <span class="rank-badge" :class="idx < 3 ? ['bg-yellow-400', 'bg-gray-400', 'bg-orange-700'][idx] : 'bg-gray-200 text-gray-500'">{{ idx + 1 }}</span>
                                    </td>
                                    <td class="px-6 py-4">
                                        <div class="font-bold text-gray-800">{{ car.model }}</div>
                                        <div class="text-xs text-gray-400">{{ car.brand }} <span v-if="car.source" class="ml-1 px-1 rounded bg-gray-100 text-gray-500">{{ car.source === 'Domestic' ? 'åœ‹ç”¢' : 'é€²å£' }}</span></div>
                                    </td>
                                    <td class="px-6 py-4 text-center">
                                        <span class="px-2 py-1 rounded text-xs font-bold inline-block" :class="getCategoryBadge(car.category)">{{ car.category }}</span>
                                    </td>
                                    <td class="px-6 py-4 text-right font-bold text-blue-600 text-lg">{{ car.count.toLocaleString() }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div v-if="currentView === 'ranking'" class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden min-h-[600px]">
                <div class="p-4 border-b border-gray-200 bg-gray-50 flex flex-col md:flex-row gap-4 justify-between">
                    <div class="flex gap-2 flex-wrap">
                        <select v-model="selectedMonth" class="bg-white border border-gray-300 text-sm rounded-lg p-2.5">
                            <option v-for="m in sortedMonths" :value="m">{{ formatMonth(m) }}</option>
                        </select>
                        <select v-model="filterCategory" class="bg-white border border-gray-300 text-sm rounded-lg p-2.5 font-bold text-gray-700">
                            <option value="All">ğŸ† æ‰€æœ‰è»Šç¨®ç¸½æ’è¡Œ</option>
                            <hr>
                            <option value="Domestic_SUV">ğŸš™ åœ‹ç”¢ä¼‘æ—…æ’è¡Œ</option>
                            <option value="Import_SUV">âœˆï¸ é€²å£ä¼‘æ—…æ’è¡Œ</option>
                            <option value="Domestic_Car">ğŸš— åœ‹ç”¢è½è»Š/æ€èƒŒæ’è¡Œ</option>
                            <option value="Import_Car">âœˆï¸ é€²å£è½è»Š/æ€èƒŒæ’è¡Œ</option>
                            <option value="Luxury">ğŸ’ è±ªè¯å“ç‰Œæ’è¡Œ</option>
                            <option value="EV">âš¡ é›»å‹•è»Šæ’è¡Œ</option>
                            <hr>
                            <option value="7Seater">ğŸš ä¸ƒäººåº§/MPVæ’è¡Œ</option>
                            <option value="Commercial">ğŸš› å•†ç”¨è»Šæ’è¡Œ</option>
                            <option value="Hybrid">ğŸ”‹ æ²¹é›»æ··åˆæ’è¡Œ</option>
                        </select>
                    </div>
                    <div class="relative w-full md:w-64">
                        <input v-model="searchQuery" type="text" placeholder="æœå°‹è»Šæ¬¾..." class="w-full pl-3 pr-4 py-2 border border-gray-300 rounded-lg text-sm">
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left text-gray-500 min-w-[600px]">
                        <thead class="text-xs text-gray-700 uppercase bg-gray-100">
                            <tr>
                                <th class="px-6 py-3 text-center">Rank</th>
                                <th class="px-6 py-3">Model</th>
                                <th class="px-6 py-3 text-center">Category</th>
                                <th class="px-6 py-3 text-right">Units</th>
                                <th class="px-6 py-3 text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(car, idx) in filteredRanking" :key="idx" class="bg-white border-b hover:bg-gray-50">
                                <td class="px-6 py-4 text-center font-bold text-gray-500">{{ idx + 1 }}</td>
                                <td class="px-6 py-4">
                                    <div class="font-bold text-gray-900 text-base">{{ car.model }}</div>
                                    <div class="text-xs text-gray-500">{{ car.brand }} <span v-if="car.source" class="ml-1 px-1 rounded bg-gray-100 text-gray-500 text-[10px]">{{ car.source === 'Domestic' ? 'åœ‹ç”¢' : 'é€²å£' }}</span></div>
                                </td>
                                <td class="px-6 py-4 text-center"><span class="px-2 py-1 rounded text-xs font-bold" :class="getCategoryBadge(car.category)">{{ car.category }}</span></td>
                                <td class="px-6 py-4 text-right font-bold text-gray-800 text-base">{{ car.count.toLocaleString() }}</td>
                                <td class="px-6 py-4 text-center">
                                    <button @click="showTrend(car.model)" class="text-blue-600 hover:bg-blue-50 border border-blue-200 px-3 py-1 rounded text-xs">è¶¨å‹¢</button>
                                </td>
                            </tr>
                            <tr v-if="filteredRanking.length === 0">
                                <td colspan="5" class="px-6 py-12 text-center text-gray-400">
                                    <i class="fas fa-folder-open text-3xl mb-2"></i><br>æ­¤åˆ†é¡æœ¬æœˆç„¡è³‡æ–™
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div v-if="currentView === 'trend'" class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <div class="mb-6 max-w-md mx-auto">
                    <label class="block mb-2 text-sm font-medium text-gray-900">æŸ¥è©¢æ­·å²è¶¨å‹¢</label>
                    <div class="relative">
                        <input v-model="trendSearch" 
                               @input="showDropdown = true" 
                               @focus="showDropdown = true"
                               type="text" 
                               placeholder="è¼¸å…¥è»Šå (ä¾‹å¦‚: Corolla Cross)..." 
                               class="w-full p-3 border border-gray-300 rounded-lg shadow-sm">
                        
                        <div v-if="trendSuggestions.length > 0 && trendSearch && showDropdown" class="absolute z-10 w-full bg-white border border-gray-200 rounded-lg shadow-lg mt-1 max-h-60 overflow-y-auto">
                            <div v-for="model in trendSuggestions" @click="selectTrendModel(model)" class="px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm">{{ model }}</div>
                        </div>
                    </div>
                </div>
                <div v-if="hasSelectedCar" class="relative h-[400px] w-full"><canvas id="salesChart"></canvas></div>
                <div v-else class="text-center py-20 text-gray-400 bg-gray-50 rounded-lg border-2 border-dashed border-gray-200"><p>è«‹æœå°‹ä¸¦é¸æ“‡è»Šæ¬¾</p></div>
            </div>
        </div>
    </main>

    <footer class="bg-gray-800 text-white text-center py-4 mt-auto text-sm">
        æ•¸æ“šè³‡æ–™ç”±ç¾ä»£æ±½è»Šæä¾›ï¼Œç‰¹åˆ¥æ„Ÿè¬äººå¸¥å¿ƒæ›´å¸¥çš„æºå“¥
    </footer>
</div>

<script>
    const { createApp } = Vue;

    createApp({
        data() {
            return {
                currentView: 'dashboard',
                selectedMonth: '',
                filterCategory: 'All',
                searchQuery: '',
                trendSearch: '',
                showDropdown: false,
                salesData: [],
                chartInstance: null,
                battlefields: [],
                loading: true,
                hasSelectedCar: false
            }
        },
        mounted() {
            fetch('./sales-data.json?v=' + new Date().getTime())
                .then(response => response.json())
                .then(data => {
                    this.salesData = data.map(d => ({
                        ...d,
                        source: this.getCarSource(d.brand, d.model)
                    }));
                    const months = [...new Set(this.salesData.map(d => d.month))].sort().reverse();
                    if (months.length > 0) this.selectedMonth = months[0];
                    this.updateBattlefields();
                    this.loading = false;
                })
                .catch(err => {
                    console.error('Data Load Error:', err);
                    this.loading = false;
                });
        },
        computed: {
            sortedMonths() {
                const months = [...new Set(this.salesData.map(d => d.month))];
                return months.sort().reverse();
            },
            currentMonthData() {
                return this.salesData.filter(d => d.month === this.selectedMonth);
            },
            top10List() {
                return this.currentMonthData
                    .filter(d => d.category !== 'Other')
                    .sort((a, b) => b.count - a.count)
                    .slice(0, 10);
            },
            filteredRanking() {
                let data = this.currentMonthData;
                if (this.filterCategory === 'Domestic_SUV') {
                    data = data.filter(d => d.source === 'Domestic' && d.category === 'SUV');
                } else if (this.filterCategory === 'Import_SUV') {
                    data = data.filter(d => d.source === 'Import' && d.category === 'SUV' && !this.isLuxury(d.brand));
                } else if (this.filterCategory === 'Domestic_Car') {
                    data = data.filter(d => d.source === 'Domestic' && (d.category === 'Sedan' || d.category === 'Hatchback'));
                } else if (this.filterCategory === 'Import_Car') {
                    data = data.filter(d => d.source === 'Import' && (d.category === 'Sedan' || d.category === 'Hatchback') && !this.isLuxury(d.brand));
                } else if (this.filterCategory === 'Luxury') {
                    data = data.filter(d => this.isLuxury(d.brand));
                } else if (this.filterCategory === 'EV') {
                    data = data.filter(d => d.category === 'EV');
                } else if (this.filterCategory === '7Seater') {
                    data = data.filter(d => this.isSevenSeater(d.model) || d.category === 'MPV');
                } else if (this.filterCategory === 'Commercial') {
                    data = data.filter(d => this.isCommercial(d.model) || d.category === 'Other');
                } else if (this.filterCategory === 'Hybrid') {
                    data = data.filter(d => this.isHybridAvailable(d.brand, d.model));
                } else if (this.filterCategory !== 'All') {
                    data = data.filter(d => d.category === this.filterCategory);
                }

                if (this.searchQuery) {
                    const q = this.searchQuery.toLowerCase();
                    data = data.filter(d => d.model.toLowerCase().includes(q) || d.brand.toLowerCase().includes(q));
                }
                return data.sort((a, b) => b.count - a.count);
            },
            trendSuggestions() {
                if (!this.trendSearch) return [];
                const q = this.trendSearch.toLowerCase();
                const allModels = [...new Set(this.salesData.map(d => d.model))];
                return allModels.filter(m => m.toLowerCase().includes(q)).slice(0, 5);
            },
            chartDataAvailable() { return this.chartInstance !== null; }
        },
        watch: {
            selectedMonth() { this.updateBattlefields(); },
            currentView(newVal) {
                if (newVal === 'trend' && this.trendSearch && this.hasSelectedCar) {
                    setTimeout(() => {
                        this.renderChart(this.trendSearch);
                    }, 400); 
                }
            }
        },
        methods: {
            formatMonth(ym) {
                if (!ym) return '';
                const [y, m] = ym.split('-');
                return `${y}å¹´ ${parseInt(m)}æœˆ`;
            },
            getCategoryBadge(cat) {
                const map = {
                    'SUV': 'bg-orange-100 text-orange-600',
                    'Sedan': 'bg-blue-100 text-blue-600',
                    'Hatchback': 'bg-yellow-100 text-yellow-600',
                    'MPV': 'bg-purple-100 text-purple-600',
                    'EV': 'bg-green-100 text-green-600',
                    'Other': 'bg-gray-100 text-gray-500'
                };
                return map[cat] || map['Other'];
            },
            getCarSource(brand, model) {
                const domesticList = ['Nissan', 'Ford', 'Honda', 'Hyundai', 'Mitsubishi', 'ä¸­è¯CMC', 'ç´æ™ºæ·', 'Luxgen', 'MG', 'ä¸‰é™½', 'è£•éš†', 'å°æœ¬', 'åœ‹ç‘', 'ç¦ç‰¹'];
                const domesticModels = ['Corolla Cross', 'Altis', 'Yaris Cross', 'Vios', 'Sienta', 'Town Ace', 'Zinger', 'Sentra', 'Kicks', 'X-Trail', 'Kuga', 'Focus', 'CR-V', 'Fit', 'HR-V', 'Custin', 'Tucson L', 'Venue'];
                if (brand.includes('Toyota') || brand.includes('TOYOTA')) {
                    if (domesticModels.some(m => model.includes(m))) return 'Domestic';
                    return 'Import';
                }
                if (domesticList.some(b => brand.includes(b))) return 'Domestic';
                return 'Import';
            },
            isLuxury(brand) {
                const luxury = ['Lexus', 'BENZ', 'M-Benz', 'BMW', 'Volvo', 'Tesla', 'Audi', 'Porsche', 'LEXUS', 'Land Rover', 'Jaguar'];
                return luxury.some(b => brand.includes(b));
            },
            isSevenSeater(model) {
                const list = ['Custin', 'Carnival', 'Alphard', 'Sienna', 'LM', 'Kodiaq', 'Sorento', 'CX-9', 'CX-90', 'Santa Fe', '5008', 'Discovery', 'Defender 130', 'X7', 'GLS', 'Q7', 'Granvia', 'Odyssey', 'Sienta', 'Berlingo', 'Caddy'];
                return list.some(k => model.includes(k));
            },
            isCommercial(model) {
                const list = ['Town Ace', 'Veryca', 'Delica', 'Zinger Pick up', 'Porter', 'J Space', 'Granvia', 'Hiace'];
                return list.some(k => model.includes(k));
            },
            isHybridAvailable(brand, model) {
                const hybrids = ['Corolla Cross', 'RAV4', 'Altis', 'Camry', 'Prius', 'Crown', 'Sienna', 'Alphard', 'LM', 'NX', 'RX', 'UX', 'LBX', 'ES', 'IS', 'LS', 'Fit', 'Civic', 'X-Trail', 'Kicks', 'HS', 'Ignis', 'Swift', 'Vitara'];
                if (brand.includes('Lexus') || brand.includes('LEXUS')) return true;
                return hybrids.some(k => model.includes(k));
            },
            updateBattlefields() {
                const data = this.currentMonthData;
                const getTop3 = (filterFn) => data.filter(filterFn).sort((a, b) => b.count - a.count).slice(0, 3);

                this.battlefields = [
                    { 
                        title: 'åœ‹ç”¢ä¼‘æ—… Top 3', filterKey: 'Domestic_SUV', icon: 'fas fa-truck-monster', textClass: 'text-orange-600', bgLight: 'bg-orange-50',
                        data: getTop3(d => d.source === 'Domestic' && d.category === 'SUV')
                    },
                    { 
                        title: 'é€²å£ä¼‘æ—… Top 3', filterKey: 'Import_SUV', icon: 'fas fa-plane-arrival', textClass: 'text-blue-600', bgLight: 'bg-blue-50',
                        data: getTop3(d => d.source === 'Import' && d.category === 'SUV' && !this.isLuxury(d.brand))
                    },
                    { 
                        title: 'åœ‹ç”¢è½è»Š/æ€èƒŒ Top 3', filterKey: 'Domestic_Car', icon: 'fas fa-car-side', textClass: 'text-green-600', bgLight: 'bg-green-50',
                        data: getTop3(d => d.source === 'Domestic' && (d.category === 'Sedan' || d.category === 'Hatchback'))
                    },
                    { 
                        title: 'é€²å£è½è»Š/æ€èƒŒ Top 3', filterKey: 'Import_Car', icon: 'fas fa-car', textClass: 'text-teal-600', bgLight: 'bg-teal-50',
                        data: getTop3(d => d.source === 'Import' && (d.category === 'Sedan' || d.category === 'Hatchback') && !this.isLuxury(d.brand))
                    },
                    { 
                        title: 'è±ªè¯å“ç‰Œ Top 3', filterKey: 'Luxury', icon: 'fas fa-gem', textClass: 'text-purple-600', bgLight: 'bg-purple-50',
                        data: getTop3(d => this.isLuxury(d.brand))
                    },
                    { 
                        title: 'é›»å‹•è»Š Top 3', filterKey: 'EV', icon: 'fas fa-bolt', textClass: 'text-yellow-600', bgLight: 'bg-yellow-50',
                        data: getTop3(d => d.category === 'EV')
                    },
                    { 
                        title: 'ä¸ƒäººåº§/MPV Top 3', filterKey: '7Seater', icon: 'fas fa-users', textClass: 'text-indigo-600', bgLight: 'bg-indigo-50',
                        data: getTop3(d => this.isSevenSeater(d.model) || d.category === 'MPV')
                    },
                    { 
                        title: 'å•†ç”¨è»Š Top 3', filterKey: 'Commercial', icon: 'fas fa-truck-loading', textClass: 'text-gray-600', bgLight: 'bg-gray-100',
                        data: getTop3(d => this.isCommercial(d.model) || d.category === 'Other')
                    },
                    { 
                        title: 'æ²¹é›»æ··åˆ Top 3', filterKey: 'Hybrid', icon: 'fas fa-leaf', textClass: 'text-emerald-600', bgLight: 'bg-emerald-50',
                        data: getTop3(d => this.isHybridAvailable(d.brand, d.model))
                    }
                ];
            },
            jumpToRanking(filterKey) {
                this.filterCategory = filterKey;
                this.currentView = 'ranking';
            },
            showTrend(modelName) {
                this.trendSearch = modelName;
                this.hasSelectedCar = true;
                this.showDropdown = false;
                this.currentView = 'trend';
            },
            selectTrendModel(modelName) {
                this.trendSearch = modelName;
                this.hasSelectedCar = true;
                this.showDropdown = false;
                setTimeout(() => {
                    this.renderChart(modelName);
                }, 300);
            },
            renderChart(modelName) {
                const ctx = document.getElementById('salesChart');
                if (!ctx) return;
                const modelData = this.salesData.filter(d => d.model === modelName);
                const months = [...new Set(this.salesData.map(d => d.month))].sort();
                const counts = months.map(m => {
                    const record = modelData.find(d => d.month === m);
                    return record ? record.count : 0;
                });
                if (this.chartInstance) this.chartInstance.destroy();
                this.chartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [{
                            label: modelName + ' éŠ·å”®è¶¨å‹¢',
                            data: counts,
                            borderColor: 'rgb(37, 99, 235)',
                            backgroundColor: 'rgba(37, 99, 235, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false }
                });
            }
        }
    }).mount('#car-sales-app');
</script>

</body>
</html>
